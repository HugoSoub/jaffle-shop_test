version: 2

models:
  - name: top3_customers_by_invoiced_amount_month
    description: Top 3 customers by monthly invoiced amount, based on stg_orders.order_total.
    columns:
      - name: month_clean
        description: Order month (truncated to the first day).
        data_tests:
          - not_null

      - name: customer_id
        description: Unique customer identifier.
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_customers')
                field: customer_id

      - name: customer_name
        description: Customer name.
        data_tests:
          - not_null

      - name: invoiced_amount_ttc
        description: Monthly invoiced amount (tax included), aggregated.
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: monthly_rank
        description: Monthly rank (1 to 3).
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 3
